<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Simple</title>
    <script src="https://unpkg.com/d3@5.9.2/dist/d3.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/metrics-graphics@2.15.6/dist/metricsgraphics.css"/>
    <script src="https://unpkg.com/metrics-graphics@2.15.6/dist/metricsgraphics.min.js"></script>
  </head>
  <body>
    <p>
      This method uses a infinite loop to run as fast as possible without yielding back to the event loop.
    </p>
    <div id="chart"/>
    <script src="functions.js"></script>
    <script>
      measure("window.setInterval", function(callback) {
        let running = true;
        window.setTimeout(function () {
          while (running && document.hidden) {
            callback();
          }
        }, 1);
        return function() {
          running = false;
        };
      }, function(dataPoints) {
        const data = d3.nest()
                .key(d => d3.timeSecond(d.timeSinceFirstTick).getTime() / 1000)
                .rollup(d => d.length)
                .entries(dataPoints);
        console.table(data);
        MG.data_graphic({
          title: "Ticks per second",
          data: data,
          width: 600,
          height: 200,
          right: 40,
          target: document.getElementById('chart'),
          x_accessor: 'key',
          x_label: 'Seconds since start',
          y_accessor: 'value',
          y_label: 'Ticks per second',
        });
      });
    </script>
  </body>
</html>
